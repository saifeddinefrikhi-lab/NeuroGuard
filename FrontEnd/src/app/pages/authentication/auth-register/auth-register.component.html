<div class="auth-main">
  <div class="auth-wrapper v3">
    <div class="auth-form">
      <div class="card my-5">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-end mb-4">
            <h3 class="mb-0"><b>Create Account</b></h3>
            <a [routerLink]="['/login']" class="link-primary">Already have an account?</a>
          </div>

          <!-- Success Alert -->
          <div class="alert alert-success alert-dismissible fade show" role="alert" *ngIf="successMessage">
            <i class="ti ti-check-circle me-2"></i>
            {{ successMessage }}
            <button type="button" class="btn-close" (click)="clearMessages()" aria-label="Close"></button>
          </div>

          <!-- Error Alert -->
          <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="errorMessage">
            <i class="ti ti-alert-circle me-2"></i>
            <strong>Error!</strong> {{ errorMessage }}
            <button type="button" class="btn-close" (click)="clearMessages()" aria-label="Close"></button>
          </div>

          <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
            <!-- First Row: First Name and Last Name -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="firstName">First Name*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['firstName'].invalid"
                    [class.is-valid]="submitted && f['firstName'].valid"
                    id="firstName" 
                    formControlName="firstName"
                    placeholder="Enter first name" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['firstName'].invalid">
                    {{ getFieldErrorMessage('firstName') }}
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="lastName">Last Name*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['lastName'].invalid"
                    [class.is-valid]="submitted && f['lastName'].valid"
                    id="lastName" 
                    formControlName="lastName"
                    placeholder="Enter last name" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['lastName'].invalid">
                    {{ getFieldErrorMessage('lastName') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Second Row: Username and Email -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="username">Username*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['username'].invalid"
                    [class.is-valid]="submitted && f['username'].valid"
                    id="username" 
                    formControlName="username"
                    placeholder="Enter username" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['username'].invalid">
                    {{ getFieldErrorMessage('username') }}
                  </div>
                  <small class="text-muted">Letters, numbers, dots and underscores only</small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="email">Email*</label>
                  <input 
                    type="email" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['email'].invalid"
                    [class.is-valid]="submitted && f['email'].valid"
                    id="email" 
                    formControlName="email"
                    placeholder="Enter email address" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['email'].invalid">
                    {{ getFieldErrorMessage('email') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Third Row: Phone Number and Gender -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="phoneNumber">Phone Number*</label>
                  <input 
                    type="tel" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['phoneNumber'].invalid"
                    [class.is-valid]="submitted && f['phoneNumber'].valid"
                    id="phoneNumber" 
                    formControlName="phoneNumber"
                    placeholder="+12334567890"
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['phoneNumber'].invalid">
                    {{ getPhoneErrorMessage() }}
                  </div>
                  <small class="text-muted">Format: +[country code][number] (e.g., +12334567890)</small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="gender">Gender*</label>
                  <select 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['gender'].invalid"
                    [class.is-valid]="submitted && f['gender'].valid"
                    id="gender" 
                    formControlName="gender"
                  >
                    <option value="">Select gender</option>
                    <option value="MALE">Male</option>
                    <option value="FEMALE">Female</option>
                  </select>
                  <div class="invalid-feedback" *ngIf="submitted && f['gender'].invalid">
                    {{ getFieldErrorMessage('gender') }}
                  </div>
                </div>
              </div>
            </div>


            <!-- Fourth Row: Age and Role -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="age">Age*</label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['age'].invalid"
                    [class.is-valid]="submitted && f['age'].valid"
                    id="age" 
                    formControlName="age"
                    placeholder="Enter your age" 
                    min="18"
                    max="150"
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['age'].invalid">
                    {{ getAgeErrorMessage() }}
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="role">Account Type*</label>
                  <select 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['role'].invalid"
                    [class.is-valid]="submitted && f['role'].valid"
                    id="role" 
                    formControlName="role"
                  >
                    <option value="PATIENT">Patient</option>
                    <option value="PROVIDER">Healthcare Provider</option>
                    <option value="CAREGIVER">Caregiver</option>
                    <option value="ADMIN">Administrator</option>
                  </select>
                  <div class="invalid-feedback" *ngIf="submitted && f['role'].invalid">
                    {{ getFieldErrorMessage('role') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Fifth Row: Password and Confirm Password -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="password">Password*</label>
                  <input 
                    type="password" 
                    class="form-control" 
                    [class.is-invalid]="submitted && f['password'].invalid"
                    [class.is-valid]="submitted && f['password'].valid"
                    id="password" 
                    formControlName="password"
                    placeholder="Enter password" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && f['password'].invalid">
                    {{ getPasswordErrorMessage() }}
                  </div>
                  <small class="text-muted">
                    Min 6 chars with uppercase, lowercase, and numbers
                  </small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label class="form-label" for="confirmPassword">Confirm Password*</label>
                  <input 
                    type="password" 
                    class="form-control" 
                    [class.is-invalid]="(submitted && f['confirmPassword'].invalid) || (submitted && registerForm.hasError('passwordMismatch'))"
                    [class.is-valid]="submitted && f['confirmPassword'].valid && !registerForm.hasError('passwordMismatch')"
                    id="confirmPassword" 
                    formControlName="confirmPassword"
                    placeholder="Confirm password" 
                  />
                  <div class="invalid-feedback" *ngIf="submitted && (f['confirmPassword'].invalid || registerForm.hasError('passwordMismatch'))">
                    {{ getConfirmPasswordErrorMessage() }}
                  </div>
                </div>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Create Account</span>
                <span *ngIf="isLoading">
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  Creating Account...
                </span>
              </button>
            </div>

            <p class="mt-3 text-center text-muted">
              By signing up, you agree to our 
              <a href="#" class="link-primary">Terms of Service</a> and 
              <a href="#" class="link-primary">Privacy Policy</a>
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>